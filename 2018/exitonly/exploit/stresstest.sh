#!/bin/bash

set -x

NUM=50
LOGFP="/tmp/allout.dat"

rm -f ${LOGFP}

for x in $(seq ${NUM}); do
    echo "Test $x"
    python x.py ex --host 10.210.17.66 >> ${LOGFP} &
    pids[${x}]=$!
    #sleep 1
done

echo "waiting for pids"
for pid in ${pids[*]}; do
    echo "waiting for ${pid}"
    wait $pid
done

FLAGNUM=$(cat ${LOGFP} | grep FLAG | wc -l)

#rm -f ${LOGFP}

echo "Results: ${FLAGNUM}/${NUM}"

